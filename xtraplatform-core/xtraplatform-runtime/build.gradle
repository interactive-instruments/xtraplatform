maturity = 'MATURE'

ext {
    dropwizardVersion = '3.0.2'
    jacksonVersion = '2.15.2'
}

dependencies {
    embeddedExport(group: 'io.dropwizard', name: 'dropwizard-core', version: dropwizardVersion)
    embeddedExport group: 'io.dropwizard', name: 'dropwizard-views-mustache', version: dropwizardVersion
    embeddedExport(group: 'io.dropwizard', name: 'dropwizard-client', version: dropwizardVersion)
    embeddedExport(group: 'io.dropwizard', name: 'dropwizard-auth', version: dropwizardVersion)
    embeddedExport(group: 'io.dropwizard', name: 'dropwizard-json-logging', version: dropwizardVersion)

    //TODO: use new default blackbird instead, does not work with modules out of the box
    embeddedExport group: 'com.fasterxml.jackson.module', name: 'jackson-module-afterburner', version: jacksonVersion

    embeddedExport 'commons-codec:commons-codec:1.16.0'
    embeddedExport group: 'org.threeten', name: 'threeten-extra', version: '1.5.0'
    embeddedExport group: 'jakarta.xml.bind', name: 'jakarta.xml.bind-api', version: '2.3.3'
    embeddedExport group: 'com.fasterxml.jackson.jaxrs', name: 'jackson-jaxrs-xml-provider', version: jacksonVersion

    embeddedExport(group: 'com.google.dagger', name: 'dagger', version: '2.+') {
        transitive = false
    }
    embeddedExport group: 'io.github.azahnen', name: 'dagger-auto', version: '1.0.0-SNAPSHOT'
    embeddedExport group: 'org.immutables', name: 'value', version: '2.8.8', classifier: 'annotations'
    embeddedExport group: 'org.immutables', name: 'encode', version: '2.8.8'

    //NOTE: define newer versions of transitive deps here if required
    constraints {
        embeddedExport('com.google.guava:guava:32.1.3-jre') {
            because 'bug'
        }
        /*embeddedExport('org.yaml:snakeyaml:1.33') {
            because 'critical/high vulnerabilities'
        }*/
    }
}

moduleInfo {
    requires = [
            'java.sql',
            'java.xml',
            'java.naming', //https jks keystore
            'jdk.unsupported', //caffeine
            'static jdk.management', //metrics
    ]
    exports = [
            '!io.dropwizard.logback.shaded*'
    ]
    uses = [
            'ch.qos.logback.classic.spi.Configurator',
            'org.eclipse.jetty.util.security.CredentialProvider',
            'javax.validation.valueextraction.ValueExtractor',
            'javax.validation.ConstraintValidator',
            '!org.codehaus.stax2.validation*',
    ]
    provides = [
            '!io.dropwizard.jackson.Discoverable': [],
            '!javax.xml.bind.JAXBContext'        : [],
            '!org.codehaus.stax2.validation*'    : [],
    ]
}
